<!DOCTYPE html>

<html>

<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title></title>
  <meta name="description" content="" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="design/style.css" />
  <link rel="stylesheet" href="design/animations.css" />

  <link
    href="https://fonts.googleapis.com/css?family=Material+Icons|Material+Icons+Outlined|Material+Icons+Two+Tone|Material+Icons+Round|Material+Icons+Sharp"
    rel="stylesheet">
</head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<body>
  <script>
    $.getJSON("/gamedata", function (data) {

      //Store JSON data in an array
      var info = [];
      $.each(data, function (key, val) {
        info.push(val.trim());
      });
      console.log(info);

      //Convert Spanish Peninsular Time to Eastern Standard Time
      ampm = "";
      easternTime = Number(info[1][0] + info[1][1]) - 6 - 12 + info[1].slice(2);
      if (Number(info[1][0] + info[1][1]) > 12) {
        ampm = " PM";
      } else ampm = " AM";

      //Decide which team is the opponent
      opponent = "";
      stadium = "";
      if (info[2] != "FC Barcelona") {
        opponent = info[2];
      } else opponent = info[3];

      //Get current date and time
      var myDate = new Date();
      console.log(myDate);

      //Format Barcelona game time string to a Date format
      var day = info[0].slice(4,7);
      var month = info[0].slice(7,10);
      var temp = "temp";
      var gameDateString = info[0].replace(month, temp).replace(day, month).replace(temp, " "+day)+"2021"+" "+info[1]+":00";
      console.log(gameDateString);
      var gameDate = new Date(gameDateString);
      console.log(gameDate);


    

      function getTimeRemaining(endtime){
        const total = Date.parse(endtime) - Date.parse(new Date());
        const seconds = Math.floor( (total/1000) % 60 );
        const minutes = Math.floor( (total/1000/60) % 60 );
        const hours = Math.floor( (total/(1000*60*60)) % 24 );
        const days = Math.floor( total/(1000*60*60*24) );

        return {
          total,
          days,
          hours,
          minutes,
          seconds
        };
      }

      function initializeClock(id, endtime) {
        const clock = document.getElementById(id);
        const daysSpan = clock.querySelector('.days');
        const hoursSpan = clock.querySelector('.hours');
        const minutesSpan = clock.querySelector('.minutes');
        const secondsSpan = clock.querySelector('.seconds');

      function updateClock() {
        const t = getTimeRemaining(endtime);

        daysSpan.innerHTML = t.days;
        hoursSpan.innerHTML = ('0' + t.hours).slice(-2);
        minutesSpan.innerHTML = ('0' + t.minutes).slice(-2);
        secondsSpan.innerHTML = ('0' + t.seconds).slice(-2);

        if (t.total <= 0) {
          clearInterval(timeinterval);
        }
      }

      updateClock();
      const timeinterval = setInterval(updateClock, 1000);
    }

    const deadline = new Date(gameDate);
    initializeClock('clockdiv', deadline);

    $("<p/>", {
      html: info[0],
    }).appendTo("#next-game-date");
    $("<p/>", {
      html: easternTime + ampm + " EST",
    }).appendTo("#next-game-time");
    $("<p/>", {
      html: opponent,
    }).appendTo("#next-opponent");
    $("<p/>", {
      html: info[4],
    }).appendTo("#next-location");
      
  });

    const element = document.getElementById('test')

    $(document).ready(function () {
      $(".button").click(function () {
        $("body").removeClass("fade-background-reverse");
        $(".material-icons-outlined").removeClass("spin-reverse");
        $(".label").removeClass("fade-text-reverse");
        $(".info").removeClass("fade-text-reverse");
        $(".card").removeClass("fade-bg-and-shadow-reverse");
        $(".button").removeClass("fade-bg-and-shadow-reverse");

        $(".button").toggleClass("dark-button");
        $(".card").toggleClass("dark-card");
        $(".label").toggleClass("dark-label");
        $(".info").toggleClass("dark-info");
        $(".material-icons-outlined").toggleClass("dark");
        $(".material-icons-outlined").toggleClass("spin");
        $("body").toggleClass("fade-background");
        $(".label").toggleClass("fade-text");
        $(".info").toggleClass("fade-text");
        $(".card").toggleClass("fade-bg-and-shadow");
        $(".button").toggleClass("fade-bg-and-shadow");

        if(!$(".button").hasClass("dark-button")){
          $("body").toggleClass("fade-background-reverse");
          $(".material-icons-outlined").toggleClass("spin-reverse");
          $(".label").toggleClass("fade-text-reverse");
          $(".info").toggleClass("fade-text-reverse");
          $(".card").toggleClass("fade-bg-and-shadow-reverse");
          $(".button").toggleClass("fade-bg-and-shadow-reverse");
        }
      });
    });
  </script>

  <h1>Countdown Clock</h1>
  <div id="clockdiv">
    <div>
      <span class="days"></span>
      <div class="smalltext">Days</div>
    </div>
    <div>
      <span class="hours"></span>
      <div class="smalltext">Hours</div>
    </div>
    <div>
      <span class="minutes"></span>
      <div class="smalltext">Minutes</div>
    </div>
    <div>
      <span class="seconds"></span>
      <div class="smalltext">Seconds</div>
    </div>
  </div>



  <div class="button" href=#>
    <span class="material-icons-outlined" style="font-size: 40px;">
      dark_mode
    </span>
  </div>
  <div class="card">
    <p class="label">Next Game</p>
    <p class="info" id="next-game-date"></p>
  </div>
  <div class="card">
    <p class="label">Kickoff</p>
    <p class="info" id="next-game-time"></p>
  </div>
  <div class="card">
    <p class="label">Next Opponent</p>
    <p class="info" id="next-opponent"></p>
  </div>
  <div class="card">
    <p class="label">Location</p>
    <p class="info" id="next-location"></p>
  </div>
</body>

</html>